angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$rootElement","$window","$timeout","$sce",function(t,e,a,n,r,i){function o(){var t=(Math.round(127*Math.random())+127).toString(16),e=(Math.round(127*Math.random())+127).toString(16),a=(Math.round(127*Math.random())+127).toString(16);return"#"+t+e+a}function l(t,e){var a=null;for(var n in t)if(angular.isElement(t[n])&&(a=angular.element(t[n]),a.hasClass(e)))return a;return a}function s(a,s){function u(){if(d()){m(),p(),f();var t=h(q);t(),$()}}function d(){if(D&&R)return!0;if(F.waitForHeightAndWidth)return!1;throw new Error("Please set height and width for the chart element")}function p(){if(!F.legend.display)return W=D,void(L=R);switch(F.legend.position){case"top":case"bottom":W=.75*D,L=R;break;case"left":case"right":W=D,L=.75*R}}function f(){var n=t.get("angularChartsTemplate_"+F.legend.position);s.html(n),e(s.contents())(a);var r=s.find("div");O=l(r,"ac-chart"),P=l(r,"ac-legend"),W-=l(r,"ac-title")[0].clientHeight}function g(){a.acConfig&&angular.extend(F,a.acConfig)}function m(){H=a.acData,q=a.acChart,S=H?H.series||[]:[],_=H?H.data||[]:[]}function h(t){var e={pie:k,bar:x,line:y,area:b,point:C};return e[t]}function v(t,e){var a=e.domain();if(F.xAxisMaxTicks&&a.length>F.xAxisMaxTicks){var n=Math.ceil(a.length/F.xAxisMaxTicks);t.tickValues(a.filter(function(t,e){return e%n===0}))}}function x(){var t={top:0,right:20,bottom:30,left:40};L-=t.left+t.right,W-=t.top+t.bottom;var e=d3.scale.ordinal().rangeRoundBands([0,L],.1),n=d3.scale.linear().range([W,10]),r=d3.scale.ordinal().rangeRoundBands([0,L],.1),i=[0];_.forEach(function(t){t.nicedata=t.y.map(function(e,a){return i.push(e),{x:t.x,y:e,s:a,tooltip:angular.isArray(t.tooltip)?t.tooltip[a]:t.tooltip}})});var o=d3.max(_.map(function(t){return t.y.length}));a.yMaxData=o,e.domain(_.map(function(t){return t.x}));var l=.2*d3.max(i);n.domain([d3.min(i),d3.max(i)+l]),r.domain(d3.range(o)).rangeRoundBands([0,e.rangeBand()]);var s=d3.svg.axis().scale(e).orient("bottom");v(s,e);var c=d3.svg.axis().scale(n).orient("left").ticks(10).tickFormat(d3.format(F.yAxisTickFormat)),u=d3.select(O[0]).append("svg").attr("width",L+t.left+t.right).attr("height",W+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");u.append("g").attr("class","x axis").attr("transform","translate(0,"+W+")").call(s),u.append("g").attr("class","y axis").call(c);var d=u.selectAll(".state").data(_).enter().append("g").attr("class","g").attr("transform",function(t){return"translate("+e(t.x)+",0)"}),p=d.selectAll("rect").data(function(t){return t.nicedata}).enter().append("rect");p.attr("width",r.rangeBand()),p.attr("x",function(t,e){return r(e)}).attr("y",W).style("fill",function(t){return B(t.s)}).attr("height",0).transition().ease("cubic-in-out").duration(F.isAnimate?1e3:0).attr("y",function(t){return n(Math.max(0,t.y))}).attr("height",function(t){return Math.abs(n(t.y)-n(0))}),p.on("mouseover",function(t){w({index:t.x,value:t.tooltip?t.tooltip:t.y,series:S[t.s]},d3.event),F.mouseover(t,d3.event),a.$apply()}).on("mouseleave",function(t){A(),F.mouseout(t,d3.event),a.$apply()}).on("mousemove",function(t){T(t,d3.event)}).on("click",function(t){F.click.call(t,d3.event),a.$apply()}),F.labels&&d.selectAll("not-a-class").data(function(t){return t.nicedata}).enter().append("text").attr("x",function(t,e){return r(e)}).attr("y",function(t){return W-Math.abs(n(t.y)-n(0))}).text(function(t){return t.y}),u.append("line").attr("x1",L).attr("y1",n(0)).attr("y2",n(0)).style("stroke","silver")}function y(){function t(t){return Math.round(n(t))+n.rangeBand()/2}var e={top:0,right:40,bottom:20,left:40};L-=e.left+e.right,W-=e.top+e.bottom;var n=d3.scale.ordinal().domain(_.map(function(t){return t.x})).rangeRoundBands([0,L]),r=d3.scale.linear().range([W,10]),i=d3.svg.axis().scale(n).orient("bottom");v(i,n);var o=d3.svg.axis().scale(r).orient("left").ticks(5).tickFormat(d3.format(F.yAxisTickFormat)),l=d3.svg.line().interpolate(F.lineCurveType).x(function(e){return t(e.x)}).y(function(t){return r(t.y)}),s=[0],c=[];_.forEach(function(t){t.y.map(function(t){s.push(t)})});var u=d3.max(_.map(function(t){return t.y.length}));a.yMaxData=u,S.slice(0,u).forEach(function(t,e){var a={};a.series=t,a.values=_.map(function(t){return t.y.map(function(e){return{x:t.x,y:e,tooltip:t.tooltip}})[e]||{x:_[e].x,y:0}}),c.push(a)});var d=d3.select(O[0]).append("svg").attr("width",L+e.left+e.right).attr("height",W+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),p=.2*d3.max(s);r.domain([d3.min(s),d3.max(s)+p]),d.append("g").attr("class","x axis").attr("transform","translate(0,"+W+")").call(i),d.append("g").attr("class","y axis").call(o);var f=d.selectAll(".points").data(c).enter().append("g"),g=f.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(t,e){return B(e)}).attr("d",function(t){return l(t.values)}).attr("stroke-width","2").attr("fill","none");if(c.length>0){var m=c[c.length-1].values;if(m.length>0){var h=g.node().getTotalLength()+t(m[m.length-1].x);g.attr("stroke-dasharray",h+" "+h).attr("stroke-dashoffset",h).transition().duration(F.isAnimate?1500:0).ease("linear").attr("stroke-dashoffset",0).attr("d",function(t){return l(t.values)})}}return angular.forEach(c,function(e){var n=d.selectAll(".circle").data(e.values).enter();n.append("circle").attr("cx",function(e){return t(e.x)}).attr("cy",function(t){return r(t.y)}).attr("r",3).style("fill",B(c.indexOf(e))).style("stroke",B(c.indexOf(e))).on("mouseover",function(t){return function(e){w({index:e.x,value:e.tooltip?e.tooltip:e.y,series:t},d3.event),F.mouseover(e,d3.event),a.$apply()}}(e.series)).on("mouseleave",function(t){A(),F.mouseout(t,d3.event),a.$apply()}).on("mousemove",function(){T(d3.event)}).on("click",function(t){F.click(t,d3.event),a.$apply()}),F.labels&&n.append("text").attr("x",function(e){return t(e.x)}).attr("y",function(t){return r(t.y)}).text(function(t){return t.y})}),"lineEnd"===F.lineLegend&&f.append("text").datum(function(t){return{name:t.series,value:t.values[t.values.length-1]}}).attr("transform",function(e){return"translate("+t(e.value.x)+","+r(e.value.y)+")"}).attr("x",3).text(function(t){return t.name}),c}function b(){function t(t){return Math.round(n(t))+n.rangeBand()/2}var e={top:0,right:40,bottom:20,left:40};L-=e.left+e.right,W-=e.top+e.bottom;var n=d3.scale.ordinal().domain(_.map(function(t){return t.x})).rangePoints([0,L]),r=d3.scale.linear().range([W,10]),i=d3.svg.axis().scale(n).orient("bottom");v(i,n);var o=d3.svg.axis().scale(r).orient("left").ticks(5).tickFormat(d3.format(F.yAxisTickFormat));d3.svg.line().interpolate(F.lineCurveType).x(function(e){return t(e.x)}).y(function(t){return r(t.y)});var l=[0],s=[];_.forEach(function(t){t.y.map(function(t){l.push(t)})});var c=d3.max(_.map(function(t){return t.y.length}));a.yMaxData=c,S.slice(0,c).forEach(function(t,e){var a={};a.series=t,a.values=_.map(function(t){return t.y.map(function(e){return{x:t.x,y:e}})[e]||{x:_[e].x,y:0}}),s.push(a)});var u=d3.select(O[0]).append("svg").attr("width",L+e.left+e.right).attr("height",W+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),d=.2*d3.max(l);r.domain([d3.min(l),d3.max(l)+d]),u.append("g").attr("class","x axis").attr("transform","translate(0,"+W+")").call(i),u.append("g").attr("class","y axis").call(o);var p=u.selectAll(".points").data(s).enter().append("g"),f=d3.svg.area().interpolate("basis").x(function(e){return t(e.x)}).y0(function(){return r(0)}).y1(function(t){return r(0+t.y)});p.append("path").attr("class","area").attr("d",function(t){return f(t.values)}).style("fill",function(t,e){return B(e)}).style("opacity","0.7")}function k(){function t(t){t.innerRadius=0;var e=d3.interpolate({startAngle:0,endAngle:0},t);return function(t){return o(e(t))}}var e=Math.min(L,W)/2,n=d3.select(O[0]).append("svg").attr("width",L).attr("height",W).append("g").attr("transform","translate("+L/2+","+W/2+")"),r=0;if(F.innerRadius){var i=F.innerRadius;i="string"==typeof i&&i.indexOf("%")>0?.01*e*parseFloat(i):Number(i),i>=0&&(r=i)}a.yMaxData=_.length;var o=d3.svg.arc().outerRadius(e-10).innerRadius(r);d3.svg.arc().outerRadius(e+5).innerRadius(0);var l=d3.layout.pie().sort(null).value(function(t){return t.y[0]}),s=n.selectAll(".arc").data(l(_)).enter().append("g"),c=!1;s.append("path").style("fill",function(t,e){return B(e)}).transition().ease("linear").duration(F.isAnimate?500:0).attrTween("d",t).attr("class","arc").each("end",function(){c||(c=!0,s.on("mouseover",function(t){w({value:t.data.tooltip?t.data.tooltip:t.data.y[0]},d3.event),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),F.mouseover(t,d3.event),a.$apply()}).on("mouseleave",function(t){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),A(),F.mouseout(t,d3.event),a.$apply()}).on("mousemove",function(t){T(t,d3.event)}).on("click",function(t){F.click(t,d3.event),a.$apply()}))}),F.labels&&s.append("text").attr("transform",function(t){return"translate("+o.centroid(t)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(t){return t.data.y[0]})}function C(){function t(t){return Math.round(n(t))+n.rangeBand()/2}var e={top:0,right:40,bottom:20,left:40};L-=e.left-e.right,W-=e.top-e.bottom;var n=d3.scale.ordinal().domain(_.map(function(t){return t.x})).rangeRoundBands([0,L]),r=d3.scale.linear().range([W,10]),i=d3.svg.axis().scale(n).orient("bottom");v(i,n);var o=d3.svg.axis().scale(r).orient("left").ticks(5).tickFormat(d3.format(F.yAxisTickFormat)),l=[0],s=[];_.forEach(function(t){t.y.map(function(t){l.push(t)})});var c=d3.max(_.map(function(t){return t.y.length}));a.yMaxPoints=c,S.slice(0,c).forEach(function(t,e){var a={};a.series=t,a.values=_.map(function(t){return t.y.map(function(e){return{x:t.x,y:e}})[e]||{x:_[e].x,y:0}}),s.push(a)});var u=d3.select(O[0]).append("svg").attr("width",L+e.left+e.right).attr("height",W+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),d=.2*d3.max(l);r.domain([d3.min(l),d3.max(l)+d]),u.append("g").attr("class","x axis").attr("transform","translate(0,"+W+")").call(i),u.append("g").attr("class","y axis").call(o),u.selectAll(".points").data(s).enter().append("g"),angular.forEach(s,function(e){var n=u.selectAll(".circle").data(e.values).enter();n.append("circle").attr("cx",function(e){return t(e.x)}).attr("cy",function(t){return r(t.y)}).attr("r",3).style("fill",B(s.indexOf(e))).style("stroke",B(s.indexOf(e))).on("mouseover",function(t){return function(e){w({index:e.x,value:e.tooltip?e.tooltip:e.y,series:t},d3.event),F.mouseover(e,d3.event),a.$apply()}}(e.series)).on("mouseleave",function(t){A(),F.mouseout(t,d3.event),a.$apply()}).on("mousemove",function(){T(d3.event)}).on("click",function(t){F.click(t,d3.event),a.$apply()}),F.labels&&n.append("text").attr("x",function(e){return t(e.x)}).attr("y",function(t){return r(t.y)}).text(function(t){return t.y})})}function w(t,e){if(F.tooltips){t="function"==typeof F.tooltips?F.tooltips(t):t.value;var n=angular.element('<p class="ac-tooltip"></p>').html(t).css({left:e.pageX+20+"px",top:e.pageY-30+"px"});angular.element(document.querySelector(".ac-tooltip")).remove(),angular.element(document.body).append(n),a.$tooltip=n}}function A(){a.$tooltip&&a.$tooltip.remove()}function T(){}function $(){a.legends=[],"pie"===q&&angular.forEach(_,function(t,e){a.legends.push({color:F.colors[e],title:E(t.x)})}),("bar"===q||"area"===q||"point"===q||"line"===q&&"traditional"===F.lineLegend)&&angular.forEach(S,function(t,e){a.legends.push({color:F.colors[e],title:E(t)})})}function M(t){return String(t).replace(/[&<>"'\/]/g,function(t){return z[t]})}function E(t){return i.trustAsHtml(F.legend.htmlEnabled?t:M(t))}function B(t){if(t<F.colors.length)return F.colors[t];var e=o();return F.colors.push(e),e}var F={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left",htmlEnabled:!1},colors:c,innerRadius:0,lineLegend:"lineEnd",lineCurveType:"cardinal",isAnimate:!0,yAxisTickFormat:"s",waitForHeightAndWidth:!1};g();var R=s[0].clientWidth,D=s[0].clientHeight;d();var H,S,_,W,L,O,P,q,z={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},N=angular.element(n),V=null;N.bind("resize",function(){V&&r.cancel(V),V=r(function(){},100)}),a.getWindowDimensions=function(){return{h:N[0].clientHeight,w:N[0].clientWidth}},a.$watch("[acChart, acData, acConfig]",u,!0),a.$watch(function(){return{w:s[0].clientWidth,h:s[0].clientHeight}},function(t){R=t.w,D=t.h,u()},!0)}var c=["rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)"];return{restrict:"EA",link:s,transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}}]),function(){var t=".angular-charts-template .axis path,.angular-charts-template .axis line{fill:none;stroke:#333}.angular-charts-template .ac-title{font-weight:700;font-size:1.2em}.angular-charts-template .ac-chart{float:left;width:75%}.angular-charts-template .ac-line{fill:none;stroke-width:2px}.angular-charts-template table{float:left;max-width:25%;list-style:none;margin:0;padding:0}.angular-charts-template td[ng-bind]{display:inline-block}.angular-charts-template .ac-legend-box{border-radius:5px;height:15px;width:15px}.ac-tooltip{display:block;position:absolute;border:2px solid rgba(51,51,51,.9);background-color:rgba(22,22,22,.7);border-radius:5px;padding:5px;color:#fff}",e=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(e),e.styleSheet)e.styleSheet.disabled||(e.styleSheet.cssText=t);else try{e.innerHTML=t}catch(a){e.innerText=t}}(),angular.module("angularChartsTemplates",["angularChartsTemplate_left","angularChartsTemplate_right"]),angular.module("angularChartsTemplate_left",[]).run(["$templateCache",function(t){t.put("angularChartsTemplate_left",'<div class="angular-charts-template"><div class="ac-title" ng-if="acConfig.title !== false">{{acConfig.title}}</div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div><div class="ac-chart"></div></div>')}]),angular.module("angularChartsTemplate_right",[]).run(["$templateCache",function(t){t.put("angularChartsTemplate_right",'<div class="angular-charts-template"><div class="ac-title" ng-if="acConfig.title !== false">{{acConfig.title}}</div><div class="ac-chart"></div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends | limitTo:yMaxData"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div></div>')}]);